\begin{proof}
  Let \(\calC\) be a category with products and a terminal object.
  We will build an interpretation function \(\llbr{-}\)
  that maps each of the judgments of \textsc{Calc}
  into \(\calC\):
  \begin{itemize}
  \item Types \(A\) will become objects \(\llbr{A}\) of \(\calC\).
  \item Contexts \(\Gamma\) will become objects \(\llbr{\Gamma}\) of \(\calC\).
  \item Derivations of \(\Gamma \vdash M : A\) will become
    morphisms \(\llbr{\Gamma} \xlongrightarrow{\llbr{M}} \llbr{A}\).
  \item Derivations of \(\Gamma \vdash M \equiv N : A\) will become
    equalities:
    \[% https://tikzcd.yichuanshen.de/#N4Igdg9gJgpgziAXAbVABwnAlgFyxMJZABgBoBGAXVJADcBDAGwFcYkQAdDxxgIwCdgXAOL0AtmPoBfEFNLpMufIRQAmCtTpNW7LjwHAAgjLkLseAkXKlimhizaIQs+SAznlV0qrvbHzqU0YKABzeCJQADN+CDEkMhAcCCRrEF4YMCgkAGYE+x0nPT5BAFkTV2jY+JoklJp0zKQAWlyafP8igwA5GRpGenTGAAVFCxUQfiwQgAscFyiYuMR1ROTEbL6sMH9IbZAaaZh6LKddthr6LEZ2M-2QfsGRj0snLexYO-b2AD8uGJx6DgYLwIAAPYAATmIUiEHAAFABeLgAShMlCkQA
\begin{tikzcd}
                                                                                    & {} \arrow[dd, "~\rotatebox{90}{\(=\)}", phantom] &          \\
\llbr{\Gamma} \arrow[rr, "\llbr{M}", bend left] \arrow[rr, "\llbr{N}"', bend right] &                                                  & \llbr{A} \\
                                                                                    & {}                                               &
\end{tikzcd}\]
  \end{itemize}
  Each of these will be defined by induction.\footnote{
  Warning: this is going to take a while.
  }

  First, let us interpret \textsc{Calc} types.
  \begin{align}
    \llbr{\plUnit} &= 1 \\
    \llbr{A \pltimes B} &= \llbr{A} \times \llbr{B}
  \end{align}
  These equations look just like
  (\ref{eqn:calc-types-in-finset}), the interpretation
  of types given in Section~\ref{sec:calc-in-finset}.
  But their meaning is very different.
  Whereas before the operator \(\times\) was used
  to denote the Cartesian product of finite sets,
  here it denotes the categorical
  product of the objects \(\llbr{A}\) and \(\llbr{B}\)
  of an arbitrary category \(\calC\).
  Similarly, \(1\) denotes the terminal object in \(\calC\),
  not the singleton set \(\{\star\}\).

  The interpretation of \textsc{Calc} contexts is similarly straightforward.
  The empty context is interpreted as the terminal object
  and context extension is interpreted via product.
  \begin{align}
    \llbr{\ctxemp} &= 1 \\
    \llbr{\Gamma, x\ofty A} &= \llbr{\Gamma} \times \llbr{A}
  \end{align}

  Next up we have the interpretation of typing derivations.
  This is where things start getting interesting.
  We have one case per typing rule. As a warm-up,
  here is the interpretation of the typing rule for \(\plunit\).
  \begin{align}
    \llbr{
      \frac
        {~}
        {\Gamma \vdash \plunit : \plUnit}
    }
    = \angled{}_{\llbr{\Gamma}}
  \end{align}
  In words: the interpretation of \(\plunit\)
  with respect to typing context \(\Gamma\)
  is the unique morphism \(\angled{}_{\llbr{\Gamma}}\)
  from \(\llbr{\Gamma}\) to \(\llbr{\plunit}\),
  guaranteed to exist because \(\llbr{\plunit}\)
  is a terminal object of \(\calC\).

  The interpretation of \(\plunit\) is special because its typing rule has no premises.
  More generally, the interpretations of the other typing rules
  will rely inductively on interpretations of premises.
  For instance, here is the interpretation of the typing rule for \(\plfst{M}\).
  \begin{align}
    \llbr{
      \dfrac
        {\displaystyle\frac{\vdots}{{{{\Gamma \vdash M : A \pltimes B}}}}}
        {\Gamma \vdash \plfst{M} : A}
    }
    = \pi_1 \circ \llbr{\frac{\vdots}{\Gamma \vdash M : A \pltimes B}}
  \end{align}
  \footnote{\todo: Really wish I knew how to fix the spacing here.}
  In words: to interpret a typing derivation for \(\plfst{M}\)
  as shown, first interpret the subderivation
  establishing \(\Gamma \vdash M : A \pltimes B\)
  to obtain a morphism \(\llbr{\Gamma} \xrightarrow{\llbr{M}} \llbr{A\pltimes B}\),
  and then compose this morphism with the projection
  \(\llbr{A\pltimes B} \xrightarrow{\pi_1} \llbr{A}\),
  guaranteed to exist because \(\llbr{A \pltimes B}\)
  is a product of \(\llbr{A}\) and \(\llbr{B}\).

  The typing rule for \(\plsnd{M}\) is interpreted analogously.
  \begin{align}
    \llbr{
      \displaystyle\frac
        {\displaystyle\frac{\vdots}{{{{\Gamma \vdash M : A \pltimes B}}}}}
        {\Gamma \vdash \plsnd{M} : B}
    }
    = \pi_2 \circ \llbr{\frac{\vdots}{\Gamma \vdash M : A \pltimes B}}
  \end{align}

  The pair formation rule is interpreted using the universal property of product.
  \begin{align}
    \llbr{
      \displaystyle\frac
        {\displaystyle\frac{\vdots}{{{{\Gamma \vdash M : A}}}}
          \qquad
         \displaystyle\frac{\vdots}{{{{\Gamma \vdash N : B}}}}
        }
        {\Gamma \vdash \plpair{M}{N} : A \pltimes B}
    }
    = \left\langle
      \llbr{\frac{\vdots}{\Gamma \vdash M: A}}
      ,
      \llbr{\frac{\vdots}{\Gamma \vdash N: B}}
    \right\rangle
  \end{align}

  Finally we have the typing rules for variables and let-bindings.
  We have saved these rules for last because they highlight some
  interesting points regarding the categorical interpretation
  of operations on the typing context \(\Gamma\).

  First let us see how to interpret variables.
  Because typing contexts \(\Gamma\) are interpreted as iterated products,
  variables are interpreted as projections:
  \begin{align}
    \llbr{
      \frac{(x:A)\in\Gamma}{\Gamma \vdash x : A}
    }
    = \pi_x
  \end{align}
  In words: \(\pi_x\) is the canonical projection
  \(\llbr{\Gamma} \to \llbr{A}\)
  that extracts the
  ``\(x\)th component'' out of
  the iterated product used to define \(\llbr{\Gamma}\).

  You may find this intepretation of variables unsatisfying:
  what exactly is this ``canonical'' projection,
  and what does it mean to take the ``\(x\)th component''?
  Here is one way to make this precise.
  The trick is to reformulate the typing rule for variables
  in terms of two more elementary rules:
  \begin{mathpar}
    \inferrule*[right=Hit]
      {~}
      {\Gamma,x\ofty A \vdash x : A}
    \and
    \inferrule*[right=Miss]
      {\Gamma \vdash x : A}
      {\Gamma,y\ofty B \vdash x : A}
  \end{mathpar}
  Together these rules can be thought of as defining
  a procedure for checking whether a given binding \((x:A)\)
  lives in a given typing context \(\Gamma\).
  The rule \textsc{Hit} covers the case where \((x:A)\)
  matches the variable right at the end of the typing context.
  The rule \textsc{Miss} covers the case where
  it doesn't and one has to keep looking further into \(\Gamma\).

  This reformulation of the variable rule allows for a precise
  definition of the handwavy \(\pi_x\).
  \begin{align}
    \llbr{
      \frac
        {~}
        {\Gamma,x\ofty A \vdash x : A}
        ~(\textsc{Hit})
    }
    &= \pi_2
    \\
    \llbr{
      \frac
        {\displaystyle\frac{\vdots}{\Gamma \vdash x : A}}
        {\Gamma,y\ofty B \vdash x : A}
        ~(\textsc{Miss})
    }
    &=
    \llbr{
      \frac{\vdots}{\Gamma \vdash x : A}
    }
    \circ \pi_1
  \end{align}
  Using these two rules,
  we can see that \(\pi_x\) is actually a composite consisting of a string of \(\pi_1\)s followed by a \(\pi_2\),
  with the length of this string depending on where \(x\) appears in \(\Gamma\). For instance,
  \begin{align}
    &\llbr{\frac{\vdots}{x\ofty A, y\ofty B, z\ofty C \vdash x : A}} \\
    &=
    \llbr{\frac{\vdots}{x\ofty A, y\ofty B \vdash x : A}} \circ \pi_1 \\
    &=
    \llbr{\frac{\vdots}{x\ofty A \vdash x : A}} \circ \pi_1 \circ \pi_1 \\
    &=
    \pi_2 \circ \pi_1 \circ \pi_1.
  \end{align}
  Note that there are two \(\pi_1\)s in this composite. This corresponds to the fact that
  the de Bruijn index of \(x\) in the context \(x\ofty A,y\ofty B,z\ofty C\) is two.\footnote{%
    You are now a third of the way through
  the proof of Theorem~\ref{thm:calc-products}.}


  With variables out of the way, let us now turn to let-bindings.
  These also illustrate an interesting interaction
  between operations on the typing context and categorical products.
  \begin{align*}
    &\llbr{
      \frac
      {
        \displaystyle\frac{\vdots}{\Gamma\vdash M : A}
        \qquad
        \displaystyle\frac{\vdots}{\Gamma,x\ofty A\vdash N : B}
      }
      {\Gamma\vdash \pllet{x}{M}{N} : B}
    }
    \\
    &=
    \llbr{\frac{\vdots}{\Gamma,x\ofty A \vdash N : B}}
    \circ
    \left\langle
    \idt_{\llbr{\Gamma}}
    ,
    \llbr{\frac{\vdots}{\Gamma\vdash M : A}}
    \right\rangle
  \end{align*}
  Let's break this down a bit.
  By induction, we have that
  \(M\) denotes a morphism \(\llbr{\Gamma} \to \llbr{A}\)
  and \(N\) denotes a morphism \(\llbr{\Gamma,x\ofty A} = \llbr{\Gamma}\times\llbr{A} \to \llbr{B}\).
  The interpretation of \(\pllet{x}{M}{N}\)
  composes these together. The twist is that,
  because the variables in \(\Gamma\) are shared between \(M\)
  and \(N\), the object \(\llbr{\Gamma}\)
  plumbed around as well.
  This is accomplished by the morphism
  \(
    \left\langle
    \idt_{\llbr{\Gamma}}
    ,
    \llbr{\Gamma\vdash M : A}
    \right\rangle\)
    guaranteed to exist
    by the universal property of products.

  In practice, it's fairly laborious to write down
  the interpretation function explicitly as a function
  on derivations as we have done above.
  So people tend to shorten the more verbose
  \(\llbr{\dfrac{\vdots}{\Gamma\vdash M : A}}\)
  to just
  \(\llbr{M}\). Written this way, the foregoing discussion
  can be summarized in terms of the following
  equations.
  \begin{align*}
    \llbr{\plunit} &= \angled{} \\
    \llbr{\plfst{M}} &= \pi_1 \circ \llbr{M} \\
    \llbr{\plsnd{M}} &= \pi_2 \circ \llbr{M} \\
    \llbr{\plpair{M}{N}} &= \angled{\llbr{M},\llbr{N}} \\
    \llbr{x} &= \pi_x \\
    \llbr{\pllet{x}{M}{N}} &=
      \llbr{N} \circ \angled{\idt_{\llbr{\Gamma}},\llbr{M}}
  \end{align*}
  This kind of equational definition is what you will typically encounter in a paper
  that uses categorical semantics.\footnote{%
  In some cases it is desirable
  to have an interpretation function that operates
  directly on terms,
  rather than on derivations,
  as derivations can contain extraneous information
  not present in a term.
  In these cases a tricky issue comes up:
  for \(\llbr{-}\) to be a functions on terms,
  it must be the case that
  the denotation of a term does not depend on
  the precise way in which it is proved to be well-typed.
  Checking this \emph{coherence condition}
  involves showing that, for any term \(M\),
  the denotations of all typing derivations
  for \(M\) are equal~\citep{reynolds1991coherence}.
  In our case \textsc{Calc} satisfies the property that every term has at most one typing derivation
  when each bound variable is annotated with its type,
  so we won't worry too much about this.
}

  We have now seen how to interpret the types,
  typing contexts, and typing derivations of \textsc{Calc}.
  Only one task remains: interpret derivations of
  \(\Gamma \vdash M \equiv N : A\).
  There are five groups of rules to interpret.
  \begin{enumerate}
  \item First there are the rules stating that \(\equiv\)
    is an equivalence relation on well-typed terms.
    \begin{mathpar}
      \inferrule*[right=Refl]
        {\Gamma \vdash M : A}
        {\Gamma \vdash M \equiv M : A}
      \and
      \inferrule*[right=Sym]
        {\Gamma \vdash M \equiv N : A}
        {\Gamma \vdash N \equiv M : A}
      \and
      \inferrule*[right=Trans]
        {\Gamma \vdash M \equiv N : A
          \\
         \Gamma \vdash N \equiv O : A
        }
        {\Gamma \vdash M \equiv O : A}
    \end{mathpar}
  \item Next there are the \emph{congruence rules},
    so called because they state that \(\equiv\)
    is a congruence for each of the \textsc{Calc} term formers.\footnote{%
     In general, an equivalence relation \(\sim\) on a set \(X\)
     is a \emph{congruence} with respect to a function
     \(f : X \to X\) if \(x \sim x'\) implies \(f(x) \sim f(x')\).}
    \begin{mathpar}
      \inferrule*[right=Cong-Pair]
        {\Gamma \vdash M \equiv M' : A
          \\
         \Gamma \vdash N \equiv N' : B
        }
        {\Gamma \vdash \plpair{M}{N} \equiv \plpair{M'}{N'} : A \pltimes B}
      \and
      \inferrule*[right=Cong-Fst]
        {\Gamma \vdash M \equiv M' : A \pltimes B
        }
        {\Gamma \vdash \plfst{M} \equiv \plfst{M'} : A}
      \and
      \inferrule*[right=Cong-Snd]
        {\Gamma \vdash M \equiv M' : A \pltimes B
        }
        {\Gamma \vdash \plsnd{M} \equiv \plsnd{M'} : A}
      \and
      \inferrule*[right=Cong-Let]
        {\Gamma \vdash M \equiv M' : A
          \\
        \Gamma, x\ofty A \vdash N \equiv N' : B
        }
        {\Gamma \vdash (\pllet{x}{M}{N}) \equiv (\pllet{x}{M'}{N'}) : B}
    \end{mathpar}
  \item Then there are the \emph{\(\beta\) laws}
    that describe what happens when one applies an introduction
    form for a given type former followed by an elimination form.
    \begin{mathpar}
      \inferrule*[right=\(\beta^{\pltimes}_1\)]
        {\Gamma \vdash M : A
          \\
          \Gamma \vdash N : B
        }
        {\Gamma \vdash \plfst{\plpair{M}{N}} \equiv M : A}
    \and
      \inferrule*[right=\(\beta^{\pltimes}_2\)]
        {\Gamma \vdash M : A
          \\
          \Gamma \vdash N : B
        }
        {\Gamma \vdash \plfst{\plpair{M}{N}} \equiv N : B}
    \end{mathpar}
  \item Then there are the \emph{\(\eta\) laws}
    that describe what happens when one applies an elimination form
    followed by an introduction form.
    \begin{mathpar}
      \inferrule*[right=\(\eta^{\pltimes}\)]
        {\Gamma \vdash M : A \pltimes B}
        {\Gamma \vdash \plpair{\plfst{M}}{\plsnd{M}} \equiv M : A \pltimes B}
    \and
      \inferrule*[right=\(\eta^{\plUnit}\)]
        {\Gamma \vdash M : \plUnit
        }
        {\Gamma \vdash \plunit \equiv M : \plUnit}
    \end{mathpar}
  \item Last but not least, there is the law
    that let-binding is equivalent to substitution.
    \begin{mathpar}
      \inferrule*[right=Let-Sub]
        {\Gamma \vdash M : A
          \\
        \Gamma, x\ofty A \vdash N : B
        }
        {\Gamma \vdash (\pllet{x}{M}{N}) \equiv N[M/x] : B}
    \end{mathpar}
  \end{enumerate}
  Let us tackle each of these groups one by one.

  The rules in group (1) are easy to interpret:
    they correspond directly to the reflexivity,
    symmetry, and transitivity of equality of morphisms.
    For instance,
    the \textsc{Sym} rule holds because,
    if \(\llbr{M} = \llbr{N}\) for some well-typed terms \(M\) and \(N\),
    then also \(\llbr{N} = \llbr{M}\).\footnote{%
    The stickler may wonder how we know that \(M\)
    and \(N\) are well-typed here, since all we have
    in the premise of \textsc{Sym}
    is that \(M\equiv N\).
    It turns out that
    \(\equiv\) satisfies the following property:
    if \(\Gamma \vdash M \equiv N : A\),
    then \(\Gamma \vdash M : A\)
    and \(\Gamma\vdash N : A\).
    This fact can be established by induction on derivations
    of \(\Gamma \vdash M \equiv N : A\),
    and we won't belabor it.
    A slicker way of maintaining this well-typedness invariant
    throughout the definition of \(\equiv\)
    is to make well-typedness a \emph{presupposition}
    of the judgment \(\Gamma \vdash M \equiv N : A\)~\citep{martin1996meanings}.
    }

  The rules in group (2) are also relatively easy.
  In each case the proof boils down to showing that
  a given operation on morphisms respects equality.
  For instance, the rule \textsc{Cong-Pair}
  boils down to the following true statement:
  if \(\llbr{M} = \llbr{M'}\)
  and \(\llbr{N} = \llbr{N'}\)
  then \(\angled{\llbr{M},\llbr{M'}} = \angled{\llbr{N},\llbr{N'}}\).
  The other cases are similarly straightforward.

  The rules in group (3) follow from the definition of categorical product.
  The law \(\beta^{\pltimes}_1\) boils down to showing that
  \(\pi_1 \circ \angled{\llbr{M},\llbr{N}} = \llbr{M}\).
  The law \(\beta^{\pltimes}_2\) is analogous.

  The rules in group (4) follow from the definitions of categorical product
  and terminal object. First, the law \(\eta^{\plUnit}\)
  follows from the fact that any two morphisms into a terminal object are equal.
  The law \(\eta^{\pltimes}\) boils down to showing
  that, for any morphism \(\llbr{M} : \llbr{\Gamma} \to \llbr{A} \times \llbr{B}\),
  it is the case that \(\llbr{M} = \angled{\pi_1\circ \llbr{M}, \pi_2\circ\llbr{M}}\).
  This follows from a uniqueness argument.
  By definition, \(\angled{\pi_1\circ \llbr{M}, \pi_2\circ\llbr{M}}\)
  is the unique morphism \(f\) satisfying \(\pi_1\circ f = \pi_1 \circ \llbr{M}\)
  and \(\pi_2\circ f = \pi_2 \circ \llbr{N}\). But \(\llbr{M}\)
  satisfies this same property. Hence \(\llbr{M} = f = \angled{\pi_1\circ\llbr{M}, \pi_2\circ\llbr{M}}\).

  All that's left is \textsc{Let-Sub}---the rule stating that let-binding is equivalent to substitution.
  Validating this rule boils down to showing the following:
  \begin{lemma}[``Let is substitution''] \label{lem:let-is-subst}
    For all contexts \(\Gamma\), types \(A\),
    and terms \(M\) and \(N\)
    such that \(\Gamma \vdash M : A\)
    and \(\Gamma,x\ofty A \vdash N : B\),
    it holds that
    \(\llbr{N[M/x]} = \llbr{N} \circ \angled{\idt_{\llbr{\Gamma}},\llbr{M}}\).
  \end{lemma}
  This lemma essentially relates
  the syntactic operation of substituting
  of \(M\) into \(N\)
  with the semantic operation
  of composing the morphism \(\llbr{N}\) with \(\angled{\idt_{\llbr{\Gamma}},\llbr{M}}\).

  A natural proof strategy to try here is to proceed by induction on (a typing derivation for) \(N\),
  as the substitution operation \(N[M/x]\) is defined recursively on it.
  But this approach runs into a problem: the induction hypothesis one gets is not
  strong enough.
  The problematic case is when \(N = (\pllet{x'}{N_1}{N_2})\).
  In this case, we have that
  \begin{enumerate}
  \item \(\Gamma,x\ofty A \vdash N_1 : A'\) for some type \(A'\)
  \item \(\Gamma,x\ofty A,x'\ofty A' \vdash N_2 : B\)
  \end{enumerate}
  and the goal is to show that
  \begin{equation}
    \llbr{(\pllet{x'}{N_1}{N_2})[M/x]} = \llbr{\pllet{x'}{N_1}{N_2}} \circ \angled{\idt_{\llbr{\Gamma}},\llbr{M}}.
  \end{equation}
  By the definition of substitution, we have that
  \[
  (\pllet{x'}{N_1}{N_2})[M/x] = (\pllet{x'}{N_1[M/x]}{N_2[M/x]}).
  \]
  At first glance, this equation looks awfully provable from the above assumptions,\footnote{%
    You are now two thirds of the way through the proof of Theorem~\ref{thm:calc-products}.}
  by applying the induction hypothesis to
  the terms \(N_1[M/x]\) and \(N_2[M/x]\) and then performing some algebraic manipulations.
  But a closer look will reveal that \(N_2[M/x]\) actually does not fit the shape required
  for the induction hypothesis to apply.
  This is because our induction hypothesis only applies to substitutions of \(M\)
  into terms well-typed in context \(\Gamma,x\ofty A\).
  On the other hand, \(N_2[M/x]\) is a substitution
  of \(\Gamma \vdash M : A\) into \(\Gamma,x\ofty A,{\color{red}x'\ofty A'} \vdash N_2 : B\).
  This extra red entry in the typing context does not match the shape of our induction hypothesis.

  What has happened here is that the statement of Lemma~\ref{lem:let-is-subst}
  applies only to terms of the form \(N[M/x]\) where \(x\) is the right-most variable
  in the typing context used to type \(N\). But while performing the substitution \(N[M/x]\),
  we will recursively substitute \(M\) into subterms where \(x\) is \emph{not} the right-most variable
  anymore, due to the presence of let-bindings.
  Thus there is a mismatch between the recursive structure of the substitution function
  and the shape of our inductive argument.

  We can remedy this by strengthening Lemma~\ref{lem:let-is-subst}
  to the following statement, which applies to terms \(N[M/x]\) where \(x\) may occur anywhere in the context.
  \begin{lemma}[Strengthening \ref{lem:let-is-subst}] \label{lem:let-is-sub-stronger}
    For all contexts \(\Gamma\) and \(\Delta\), types \(A\),
    and terms \(M\) and \(N\)
    such that \(\Gamma \vdash M : A\)
    and \(\Gamma,x\ofty A,\Delta \vdash N : B\),
    it holds that
    \(\llbr{N[M/x]} = \llbr{N} \circ \angled{\pi_{\llbr{\Gamma}},\llbr{M} \circ \pi_{\llbr{\Gamma}},\pi_{\llbr{\Delta}}}\).
  \end{lemma}
  The statement of Lemma~\ref{lem:let-is-sub-stronger} requires some clarification.

  First, it involves morphisms
   \(\llbr{\Gamma,\Delta} \xrightarrow{\pi_{\llbr{\Gamma}}} \llbr{\Gamma} \)
  and
   \(\llbr{\Gamma,\Delta} \xrightarrow{\pi_{\llbr{\Delta}}} \llbr{\Delta}\).
  These morphisms are defined by the following fact, which can be proved
  by induction on \(\Delta\): for all \(\Gamma\) and \(\Delta\)
  it holds that \(\llbr{\Gamma,\Delta}\) is a product of \(\llbr{\Gamma}\) and \(\llbr{\Delta}\).
  The morphisms \(\pi_{\llbr{\Gamma}}\) and \(\pi_{\llbr{\Delta}}\) are the projections
  out of this product.

  Second, we have used a ternary angle-bracket operator
  to form the morphism \(\angled{\pi_{\llbr{\Gamma}},\llbr{M}\circ\pi_{\llbr{\Gamma}},\pi_{\llbr{\Delta}}}\).
  This notation is justified by the following fact, which also can be proved by induction on \(\Delta\):
  for all \(\Gamma\) and \(A\) and \(\Delta\) it holds that \(\llbr{\Gamma,x\ofty A,\Delta}\)
  is a ternary product of \(\llbr{\Gamma}\), \(\llbr{A}\), and \(\llbr{\Delta}\).
  The ternary angle-bracket then denotes the unique morphism
  given by the universal property of this ternary product.

  We are now ready to prove Lemma~\ref{lem:let-is-sub-stronger}.

  \begin{proof}[Proof of Lemma~\ref{lem:let-is-sub-stronger}]
    By induction on the derivation of \(\Gamma,x\ofty A,\Delta\vdash N : A\).
    We start with the trickiest case:
    \begin{itemize}
    \item Suppose \(N = (\pllet{x'}{N_1}{N_2})\) for some \(\Gamma,x\ofty A,\Delta\vdash N_1 : A'\)
      and some \(\Gamma,x\ofty A,\Delta,x'\ofty A' \vdash N_2 : B\).
      Then both the left- and right-hand sides of the desired equation simplify to the same expression.
      On the one hand we have
      \begin{align*}
        &\llbr{(\pllet{x'}{N_1}{N_2})[M/x]}
        \\
        &=
        \llbr{\pllet{x'}{N_1[M/x]}{N_2[M/x]}}
        \\
        &=
        \llbr{N_2[M/x]} \circ \angled{\pi_{\llbr{\Gamma,x\ofty A,\Delta}}, \llbr{N_1[M/x]}}
        \\
        &\stackrel{\text{IH}}=
        (\llbr{N_2} \circ \angled{\pi_{\llbr{\Gamma}},\llbr{M}\circ \pi_{\llbr{\Gamma}},\pi_{\llbr{\Delta,x'\ofty A'}}})
        \circ \angled{\idt_{\llbr{\Gamma,x\ofty A,\Delta}}, \llbr{N_1[M/x]}}
        \\
        &\stackrel{\text{IH}}=
        (\llbr{N_2} \circ \angled{\pi_{\llbr{\Gamma}},\llbr{M}\circ \pi_{\llbr{\Gamma}},\pi_{\llbr{\Delta,x'\ofty A'}}})
        \circ p
        \\
        &\qquad\text{where \(p =\) }
        \angled{\idt_{\llbr{\Gamma,x\ofty A,\Delta}},
          \llbr{N_1} \circ
          \angled{
            \pi_{\llbr{\Gamma}},
            \llbr{M} \circ \pi_{\llbr{\Gamma}},
            \pi_{\llbr{\Delta}}
            }}
        \\
        &=
        (\llbr{N_2} \circ \angled{\pi_{\llbr{\Gamma}} \circ p,\llbr{M}\circ \pi_{\llbr{\Gamma}} \circ p,\pi_{\llbr{\Delta,x'\ofty A''}} \circ p})
        \\
        &=
        (\llbr{N_2} \circ \angled{\pi_{\llbr{\Gamma}},\llbr{M}\circ \pi_{\llbr{\Gamma}},\pi_{\llbr{\Delta,x'\ofty A'}} \circ p})
        \\
        &=
        (\llbr{N_2} \circ
        \angled{\pi_{\llbr{\Gamma}},\llbr{M}\circ \pi_{\llbr{\Gamma}},\angled{\pi_{\llbr{\Delta}}, \llbr{N_1}
          \circ \angled{
            \pi_{\llbr{\Gamma}},
            \llbr{M} \circ \pi_{\llbr{\Gamma}},
            \pi_{\llbr{\Delta}}
            }}}
      \end{align*}
      and on the other hand we have
      \begin{align*}
        &\llbr{\pllet{x'}{N_1}{N_2}} \circ \angled{\pi_{\llbr{\Gamma}}, \llbr{M} \circ \pi_{\llbr{\Gamma}}, \pi_{\llbr{\Delta}}}
        \\
        &=\llbr{N_2} \circ \angled{\idt_{\llbr{\Gamma,x\ofty A,\Delta}}, \llbr{N_1}} \circ \angled{\pi_{\llbr{\Gamma}}, \llbr{M} \circ \pi_{\llbr{\Gamma}}, \pi_{\llbr{\Delta}}}
        \\
        &=\llbr{N_2} \circ \angled{\angled{\pi_{\llbr{\Gamma}}, \llbr{M} \circ \pi_{\llbr{\Gamma}}, \pi_{\llbr{\Delta}}}, \llbr{N_1}\circ\angled{\pi_{\llbr{\Gamma}}, \llbr{M} \circ \pi_{\llbr{\Gamma}}, \pi_{\llbr{\Delta}}}}.
      \end{align*}
      The equality of these two morphisms boils down to the equality of
      \[
\angled{\pi_{\llbr{\Gamma}},\llbr{M}\circ \pi_{\llbr{\Gamma}},\angled{\pi_{\llbr{\Delta}}, \llbr{N_1}
          \circ \angled{
            \pi_{\llbr{\Gamma}},
            \llbr{M} \circ \pi_{\llbr{\Gamma}},
            \pi_{\llbr{\Delta}}
            }}}
      \]
      and
      \[
\angled{\angled{\pi_{\llbr{\Gamma}}, \llbr{M} \circ \pi_{\llbr{\Gamma}}, \pi_{\llbr{\Delta}}}, \llbr{N_1}\circ\angled{\pi_{\llbr{\Gamma}}, \llbr{M} \circ \pi_{\llbr{\Gamma}}, \pi_{\llbr{\Delta}}}}.
      \]
      This equality follows from a uniqueness argument:
      both of these morphisms are the unique \(f : \llbr{\Gamma,\Delta} \to \llbr{\Gamma,x\ofty A,\Delta,x'\ofty A'}\)
      satisfying the following four properties:
      \begin{enumerate}
        \item \(\pi_{\llbr{\Gamma}} \circ f = \pi_{\llbr{\Gamma}}\)
        \item \(\pi_{\llbr{A}} \circ f = \llbr{M} \circ \pi_{\llbr{\Gamma}}\)
        \item \(\pi_{\llbr{\Delta}} \circ f = \llbr{M} \circ \pi_{\llbr{\Delta}}\)
        \item \(\pi_{\llbr{A'}} \circ f =  \llbr{N_1}\circ\angled{\pi_{\llbr{\Gamma}}, \llbr{M} \circ \pi_{\llbr{\Gamma}}, \pi_{\llbr{\Delta}}}\)
      \end{enumerate}
      This completes the proof of
      the case \(N = (\pllet{x'}{N_1}{N_2})\).
    \end{itemize}
    The other cases are much easier.
    \begin{itemize}
    \item Suppose \(N = \plunit\). Then
      \begin{align*}
        \llbr{\plunit[M/x]} &= \llbr{\plunit} = \angled{}
        = \angled{} \circ \angled{\pi_{\llbr{\Gamma}}, \llbr{M}\circ\pi_{\llbr{\Gamma}}, \pi_{\llbr{\Delta}}} \\
        &= \llbr{\plunit} \circ \angled{\pi_{\llbr{\Gamma}}, \llbr{M}\circ\pi_{\llbr{\Gamma}}, \pi_{\llbr{\Delta}}}.
      \end{align*}
    \item Suppose \(N = \plfst{N'}\) for some \(\Gamma,x\ofty A,\Delta \vdash \plfst{N'}\).
      Then
      \begin{align*}
        \llbr{(\plfst{N'})[M/x]}
        &= \llbr{\plfst{(N'[M/x])}}
        = \pi_1 \circ \llbr{N'[M/x]} \\
        &\stackrel{\text{IH}}=
        \pi_1 \circ \llbr{N'} \circ \angled{\pi_{\llbr{\Gamma}}, \llbr{M}\circ\pi_{\llbr{\Gamma}}, \pi_{\llbr{\Delta}}} \\
        &= \llbr{\plfst{N'}} \circ\angled{\pi_{\llbr{\Gamma}}, \llbr{M}\circ\pi_{\llbr{\Gamma}}, \pi_{\llbr{\Delta}}}.
      \end{align*}
    \item Case \(N = \plsnd{N'}\) is similar.
    \item Suppose \(N = \plpair{N_1}{N_2}\) for some \(B,N_1,N_2\) such that \(B = B_1\pltimes B_2\) and
      \(\Gamma,x\ofty A,\Delta \vdash N_1 : B_1\)
      and \(\Gamma,x\ofty A,\Delta \vdash N_2 : B_2\).
      Then
      \begin{align*}
        &\llbr{\plpair{N_1}{N_2}[M/x]}
        \\
        &=
        \llbr{\plpair{N_1[M/x]}{N_2[M/x]}}
        \\
        &=
        \angled{\llbr{N_1[M/x]},\llbr{N_2[M/x]}}
        \\
        &\stackrel{\text{IH}}=
        \angled{\llbr{N_1}\circ p,\llbr{N_2} \circ p}
        \text{ where \(p =\) }\angled{\pi_{\llbr{\Gamma}},
          \llbr{\Gamma \vdash M : A}\circ\pi_{\llbr{\Gamma}},
          \pi_{\llbr{\Delta}}}
        \\
        &= \angled{\llbr{N_1},\llbr{N_2}} \circ p\\
        &= \llbr{\plpair{N_1}{N_2}} \circ p
      \end{align*}
    \item Suppose \(N = x\).
      For this case, it will be helpful to disambiguate the ambient typing context under which a term is interpreted:
      \begin{align*}
        &\llbr{\Gamma,\Delta \vdash x[M/x] : A} \\
        &= \llbr{\Gamma,\Delta \vdash M : A} \\
        &\stackrel{(*)}= \llbr{\Gamma \vdash M : A} \circ \pi_{\llbr{\Gamma}} \\
        &= \pi_x \circ \angled{\pi_{\llbr{\Gamma}}, \llbr{M} \circ \pi_{\llbr{\Gamma}}, \pi_{\llbr{\Delta}}}
      \end{align*}
      The step marked \((*)\) can be proved as a separate lemma, by induction on typing derivations.
    \item Suppose \(N = x'\) for some \(x' \ne x\) such that \(\Gamma,x\ofty A,\Delta \vdash x' : A'\).
      Then
      \begin{align*}
        &\llbr{\Gamma,\Delta \vdash x'[M/x] : A'} \\
        &= \llbr{\Gamma, \Delta  \vdash x' : A'}\\
        &= \pi_{x'} \\
        &= \llbr{\Gamma,x\ofty A,\Delta \vdash x' : A'}
        \circ \angled{\pi_{\llbr{\Gamma}}, \llbr{M} \circ \pi_{\llbr{\Gamma}}, \pi_{\llbr{\Delta}}}.
      \end{align*}
    \end{itemize}
    This closes the induction, completing the proof of Lemma~\ref{lem:let-is-sub-stronger}.
  \end{proof}

  Lemma~\ref{lem:let-is-subst} now follows as a corollary, by setting \(\Delta = \ctxemp\).
  This in turn establishes the validity of the equational rule \textsc{Let-Sub},
  which completes the interpretation of all of the equational axioms of \textsc{Calc}
  and hence concludes the proof of Theorem~\ref{thm:calc-products}.\footnote{%
    You heard that right---Theorem~\ref{thm:calc-products} is proved.
    You are free! Well done if you made it this far.}
\end{proof}
